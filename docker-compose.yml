version: '3.8'

services:
  api:
    build:
      context: ./src/backend/BookingPro.API
      dockerfile: Dockerfile
    container_name: turnospro-api
    ports:
      - "5000:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=${DATABASE_URL:-Host=host.docker.internal;Database=bookingprodb;Username=postgres;Password=eric1234}
      - Jwt__Key=your-secret-key-here-minimum-32-characters-long-for-multi-tenant-system
      - FrontendUrl=http://localhost:3000
      - AdditionalCorsOrigins=http://demo.localhost:3000,http://mygym.localhost:3000,http://*.localhost:3000,http://localhost:3030
      - SEED_DATA=false
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID:-}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN:-}
      - TWILIO_FROM_WHATSAPP=${TWILIO_FROM_WHATSAPP:-}
      - WHATSAPP_ENABLED=true
      - WHATSAPP_DEFAULT_INCLUDED=500
      - WHATSAPP_OVERAGE_PRICE=20
      - WHATSAPP_HARDCAP=false
      - EVOLUTION_API_ENABLED=true
      - EVOLUTION_API_BASE_URL=http://64.227.3.140:8080/
      - EVOLUTION_API_KEY=${EVOLUTION_API_KEY}
      - EVOLUTION_API_INSTANCE=${EVOLUTION_API_INSTANCE}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  frontend:
    build:
      context: .
      dockerfile: src/frontend/Dockerfile
    container_name: turnospro-frontend
    ports:
      - "3000:80"
    environment:
      - REACT_APP_API_URL=http://localhost:5000/api
      - REACT_APP_APP_NAME=TurnosPro
      - API_UPSTREAM_HOST=api
      - API_UPSTREAM_PORT=8080
      - API_UPSTREAM_SCHEME=http
    depends_on:
      - api
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3